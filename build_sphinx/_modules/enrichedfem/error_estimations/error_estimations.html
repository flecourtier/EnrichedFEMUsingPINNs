

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>enrichedfem.error_estimations.error_estimations &mdash; EnrichedFEM 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            EnrichedFEM
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Run tests:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../run_tests.html">Run Tests</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../enrichedfem.error_estimations.html">enrichedfem.error_estimations package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../enrichedfem.fenics_expressions.html">enrichedfem.fenics_expressions package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../enrichedfem.gains.html">enrichedfem.gains package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../enrichedfem.geometry.html">enrichedfem.geometry package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../enrichedfem.networks.html">enrichedfem.networks package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../enrichedfem.problem.html">enrichedfem.problem package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../enrichedfem.solver_fem.html">enrichedfem.solver_fem package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">EnrichedFEM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">enrichedfem.error_estimations.error_estimations</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for enrichedfem.error_estimations.error_estimations</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">enrichedfem.problem.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_tree</span><span class="p">,</span><span class="n">select_param</span><span class="p">,</span><span class="n">compute_slope</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enrichedfem.error_estimations.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_solver_type</span>

<div class="viewcode-block" id="ErrorEstimations">
<a class="viewcode-back" href="../../../enrichedfem.error_estimations.html#enrichedfem.error_estimations.error_estimations.ErrorEstimations">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ErrorEstimations</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error estimates class for the FEM method and enriched approaches.</span>

<span class="sd">    This class allows to run the error estimates for the FEM method and enriched approaches (additive and multiplicative corrections). The L2 error is computed for different degrees and number of vertices.</span>
<span class="sd">    The results are saved in csv files and can be plotted.</span>

<span class="sd">    Args:</span>
<span class="sd">        param_num (int): Number of the parameter to consider</span>
<span class="sd">        pb_considered (Problem): Problem to consider        </span>
<span class="sd">        error_degree (int, optional): Degree of the error space. Defaults to 4.</span>
<span class="sd">        high_degree (int, optional): Degree of the expression space for f. Defaults to 9.</span>
<span class="sd">        save_fig (bool, optional): Save flag for the figures. Defaults to False.</span>
<span class="sd">        plot_result (bool, optional): Plot flag for the results. Defaults to False.</span>
<span class="sd">        plot_mesh (bool, optional): Plot flag for the mesh. Defaults to False.</span>
<span class="sd">        tab_nb_vert (list, optional): List of the number of vertices. Defaults to [2**i for i in range(4,9)].</span>
<span class="sd">        tab_degree (list, optional): List of the degrees. Defaults to [1,2,3].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_num</span><span class="p">,</span> <span class="n">pb_considered</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># define the problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_num</span> <span class="o">=</span> <span class="n">param_num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pb_considered</span> <span class="o">=</span> <span class="n">pb_considered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__infos_from_problem</span><span class="p">()</span>
        <span class="n">repo_dir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;repo_dir&#39;</span><span class="p">,</span> <span class="s2">&quot;./&quot;</span><span class="p">)</span>
        <span class="n">version_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;version</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span> <span class="o">=</span> <span class="n">repo_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/results/fenics/test_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="si">}</span><span class="s2">D/testcase</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">version_str</span><span class="si">}</span><span class="s2">/cvg/param</span><span class="si">{</span><span class="n">param_num</span><span class="si">}</span><span class="s2">/&quot;</span>
        <span class="n">create_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;## Results directory: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># define the degrees and the number of vertices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error_degree&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">high_degree</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;high_degree&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;save_fig&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_result</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plot_result&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_mesh</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plot_mesh&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab_nb_vert</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tab_nb_vert&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab_degree</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tab_degree&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
        
        <span class="c1"># define if the reference solution is an analytical solution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_uref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_considered</span><span class="o">.</span><span class="n">ana_sol</span><span class="p">:</span>
            <span class="n">savedir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span> <span class="o">+</span> <span class="s2">&quot;u_ref/&quot;</span>
            <span class="n">create_tree</span><span class="p">(</span><span class="n">savedir</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">savedir</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;u_ref_</span><span class="si">{</span><span class="n">param_num</span><span class="si">}</span><span class="s2">.npy&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_uref</span> <span class="o">=</span> <span class="p">[</span><span class="n">filename</span><span class="p">]</span>
            
        
    <span class="k">def</span><span class="w"> </span><span class="nf">__infos_from_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract problem information.</span>

<span class="sd">        This method extracts information about the problem, such as dimension,</span>
<span class="sd">        testcase, version, parameters, and solver type, from the</span>
<span class="sd">        `pb_considered` attribute and stores them as attributes of the class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_considered</span><span class="o">.</span><span class="n">dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testcase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_considered</span><span class="o">.</span><span class="n">testcase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb_considered</span><span class="o">.</span><span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">select_param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pb_considered</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">param_num</span><span class="p">)]</span>     
        <span class="bp">self</span><span class="o">.</span><span class="n">solver_type</span> <span class="o">=</span> <span class="n">get_solver_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
    
<div class="viewcode-block" id="ErrorEstimations.read_csv">
<a class="viewcode-back" href="../../../enrichedfem.error_estimations.html#enrichedfem.error_estimations.error_estimations.ErrorEstimations.read_csv">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">csv_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read a CSV file.</span>

<span class="sd">        :param csv_file: CSV file to read</span>
<span class="sd">        :return: DataFrame, list of h values, list of error values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df_meth</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>
        <span class="n">tab_h_meth</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_meth</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">tab_err_meth</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_meth</span><span class="p">[</span><span class="s1">&#39;err&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        
        <span class="n">tab_nb_vert_meth</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df_meth</span><span class="p">[</span><span class="s1">&#39;nb_vert&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">tab_nb_vert_meth</span><span class="p">)</span> <span class="o">==</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_nb_vert</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">df_meth</span><span class="p">,</span> <span class="n">tab_h_meth</span><span class="p">,</span> <span class="n">tab_err_meth</span></div>

    
<div class="viewcode-block" id="ErrorEstimations.run_error_estimations_deg">
<a class="viewcode-back" href="../../../enrichedfem.error_estimations.html#enrichedfem.error_estimations.error_estimations.ErrorEstimations.run_error_estimations_deg">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_error_estimations_deg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run error estimates for a given method and degree.</span>

<span class="sd">        This method performs error estimates using the specified method</span>
<span class="sd">        (FEM, Corr, or Mult) for a given degree. It reads results from a CSV</span>
<span class="sd">        file if available, otherwise it runs the error estimation and saves</span>
<span class="sd">        the results to a CSV file.</span>

<span class="sd">        Args:</span>
<span class="sd">            method (str): The error estimation method (&quot;FEM&quot;, &quot;Corr&quot;, or &quot;Mult&quot;).</span>
<span class="sd">            degree (int): The degree of the finite element solution.</span>
<span class="sd">            new_run (bool): Whether to force a new run even if a CSV file exists.</span>
<span class="sd">            u_theta: Network prediction. Required for &quot;Corr&quot; and &quot;Mult&quot; methods.</span>
<span class="sd">            M (float): Lifting constant. Required for &quot;Mult&quot; method.</span>
<span class="sd">            impose_bc (bool): Required for &quot;Mult&quot; method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the DataFrame, list of h values, and list</span>
<span class="sd">                of error values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_run</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;new_run&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;FEM&quot;</span><span class="p">,</span><span class="s2">&quot;Corr&quot;</span><span class="p">,</span><span class="s2">&quot;Mult&quot;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;method=</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> is not implemented&quot;</span>
        
        <span class="k">assert</span> <span class="s2">&quot;u_theta&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Corr&quot;</span><span class="p">,</span><span class="s2">&quot;Mult&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">True</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;u_theta is required for </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">u_theta</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;u_theta&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;Mult&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="s1">&#39;M&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;impose_bc&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;M and impose_bc are required for </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
            <span class="n">impose_bc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;impose_bc&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="s1">&#39;M&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;impose_bc&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;M and impose_bc are not required for </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Define the csv_file        </span>
        <span class="n">csv_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">_case</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="si">}</span><span class="s2">_v</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">_param</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">param_num</span><span class="si">}</span><span class="s2">_degree</span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;Mult&quot;</span><span class="p">:</span>
            <span class="n">csv_file</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_M</span><span class="si">{</span><span class="n">M</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">csv_file</span> <span class="o">+=</span> <span class="s1">&#39;_weak&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">impose_bc</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">csv_file</span> <span class="o">+=</span> <span class="s2">&quot;.csv&quot;</span>
        
        <span class="c1"># Read the csv file if it exists (or if not new_run)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_run</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">csv_file</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;## Read csv file : </span><span class="si">{</span><span class="n">csv_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>

        <span class="c1"># Run the error estimation</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;## Run error estimation with </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> for degree=</span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">tab_h_method</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tab_err_method</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">solver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver_type</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">problem</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pb_considered</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="n">degree</span><span class="p">,</span> <span class="n">error_degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span><span class="p">,</span> <span class="n">high_degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">high_degree</span><span class="p">,</span> <span class="n">save_uref</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save_uref</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">nb_vert</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_nb_vert</span><span class="p">:</span>
            <span class="n">mesh_filename</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_mesh</span><span class="p">:</span>
                <span class="n">results_dir_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;Mesh_plot/&quot;</span>
                <span class="n">create_tree</span><span class="p">(</span><span class="n">results_dir_mesh</span><span class="p">)</span>
                <span class="n">mesh_filename</span> <span class="o">=</span> <span class="n">results_dir_mesh</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;Mesh_plot_case</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="si">}</span><span class="s2">_v</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">_N</span><span class="si">{</span><span class="n">nb_vert</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="n">solver</span><span class="o">.</span><span class="n">set_meshsize</span><span class="p">(</span><span class="n">nb_cell</span><span class="o">=</span><span class="n">nb_vert</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">plot_mesh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_mesh</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">mesh_filename</span><span class="p">)</span>
            <span class="n">tab_h_method</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
            <span class="n">fig_filename</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_fig</span><span class="p">:</span>
                <span class="n">results_dir_fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">_plot&quot;</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;Mult&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">impose_bc</span><span class="p">:</span>
                    <span class="n">results_dir_fig</span> <span class="o">+=</span> <span class="s1">&#39;_weak&#39;</span>
                <span class="n">results_dir_fig</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
                <span class="n">create_tree</span><span class="p">(</span><span class="n">results_dir_fig</span><span class="p">)</span>
                <span class="n">fig_filename</span> <span class="o">=</span> <span class="n">results_dir_fig</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">_plot_case</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="si">}</span><span class="s2">_v</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">_param</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">param_num</span><span class="si">}</span><span class="s2">_degree</span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s2">_N</span><span class="si">{</span><span class="n">nb_vert</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;Mult&quot;</span><span class="p">:</span>
                    <span class="n">fig_filename</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_M</span><span class="si">{</span><span class="n">M</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">impose_bc</span><span class="p">:</span>
                        <span class="n">fig_filename</span> <span class="o">+=</span> <span class="s1">&#39;_weak&#39;</span>
                <span class="n">fig_filename</span> <span class="o">+=</span> <span class="s1">&#39;.pdf&#39;</span>
            
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;FEM&quot;</span><span class="p">:</span> 
                <span class="n">_</span><span class="p">,</span><span class="n">norme_L2</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">fem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">plot_result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_result</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">fig_filename</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;Corr&quot;</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">norme_L2</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">corr_add</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">u_theta</span><span class="p">,</span><span class="n">plot_result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_result</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">fig_filename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">norme_L2</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">corr_mult</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">u_theta</span><span class="p">,</span><span class="n">M</span><span class="o">=</span><span class="n">M</span><span class="p">,</span><span class="n">impose_bc</span><span class="o">=</span><span class="n">impose_bc</span><span class="p">,</span><span class="n">plot_result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_result</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">fig_filename</span><span class="p">)</span>
                
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;nb_vert=</span><span class="si">{</span><span class="n">nb_vert</span><span class="si">}</span><span class="s2">, norme_L2=</span><span class="si">{</span><span class="n">norme_L2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">tab_err_method</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">norme_L2</span><span class="p">)</span>
            
        <span class="n">df_method</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;nb_vert&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_nb_vert</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">tab_h_method</span><span class="p">,</span> <span class="s1">&#39;err&#39;</span><span class="p">:</span> <span class="n">tab_err_method</span><span class="p">})</span>
        <span class="n">df_method</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">df_method</span><span class="p">,</span> <span class="n">tab_h_method</span><span class="p">,</span> <span class="n">tab_err_method</span></div>

    
<div class="viewcode-block" id="ErrorEstimations.run_error_estimations_alldeg">
<a class="viewcode-back" href="../../../enrichedfem.error_estimations.html#enrichedfem.error_estimations.error_estimations.ErrorEstimations.run_error_estimations_alldeg">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_error_estimations_alldeg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run error estimates for a given method and all degrees.</span>

<span class="sd">        This method runs the error estimates for the given method and all</span>
<span class="sd">        degrees specified in `self.tab_degree`. It saves the results to a CSV</span>
<span class="sd">        file and optionally plots the convergence results.</span>

<span class="sd">        Args:</span>
<span class="sd">            method (str): The error estimation method (&quot;FEM&quot;, &quot;Corr&quot;, or &quot;Mult&quot;).</span>
<span class="sd">            **kwargs: Additional keyword arguments. These may include:</span>
<span class="sd">                plot_cvg (bool): Whether to plot the convergence results.</span>
<span class="sd">                u_theta: Network prediction. Required for &quot;Corr&quot; and &quot;Mult&quot; methods.</span>
<span class="sd">                M (float): Lifting constant. Required for &quot;Mult&quot; method.</span>
<span class="sd">                impose_bc (bool): Required for &quot;Mult&quot; method.</span>
<span class="sd">                new_run (bool): Whether to force a new run even if a CSV file exists.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plot_cvg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plot_cvg&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;Mult&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="s1">&#39;M&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;impose_bc&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;M and impose_bc are required for </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
            <span class="n">impose_bc</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;impose_bc&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="s1">&#39;M&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;impose_bc&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;M and impose_bc are not required for </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Define the csv_file</span>
        <span class="n">csv_file_alldeg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">_case</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="si">}</span><span class="s1">_v</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s1">_param</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">param_num</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;Mult&quot;</span><span class="p">:</span>
            <span class="n">csv_file_alldeg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_M</span><span class="si">{</span><span class="n">M</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">csv_file_alldeg</span> <span class="o">+=</span> <span class="s1">&#39;_weak&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">impose_bc</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">csv_file_alldeg</span> <span class="o">+=</span> <span class="s2">&quot;.csv&quot;</span>
        
        <span class="c1"># Run the error estimation for all degrees</span>
        <span class="n">dict_alldeg</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">degree</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_degree</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">tab_err_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_error_estimations_deg</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="n">degree</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
            <span class="c1"># to save</span>
            <span class="k">if</span> <span class="n">degree</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">dict_alldeg</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_nb_vert</span>
            <span class="n">dict_alldeg</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;P</span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tab_err_method</span>
            
        <span class="n">df_deg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_alldeg</span><span class="p">)</span>
        <span class="n">df_deg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_file_alldeg</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">plot_cvg</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
            
            <span class="k">for</span> <span class="n">degree</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab_degree</span><span class="p">:</span>
                <span class="n">tab_err_method</span> <span class="o">=</span> <span class="n">dict_alldeg</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;P</span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
                
                <span class="c1"># to plot</span>
                <span class="k">if</span> <span class="n">plot_cvg</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_nb_vert</span><span class="p">,</span> <span class="n">tab_err_method</span><span class="p">,</span> <span class="s2">&quot;+-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">degree</span><span class="p">))</span>
                
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_nb_vert</span><span class="p">)):</span>
                        <span class="n">slope</span><span class="p">,</span> <span class="n">vert_mid</span> <span class="o">=</span> <span class="n">compute_slope</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_nb_vert</span><span class="p">,</span><span class="n">tab_err_method</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">vert_mid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-2</span> <span class="p">,</span> <span class="n">vert_mid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">slope</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_nb_vert</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab_nb_vert</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;nb_vert&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;L2 norm&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">!=</span> <span class="s2">&quot;Mult&quot;</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1"> case</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="si">}</span><span class="s1"> v</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s1"> param</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">param_num</span><span class="si">}</span><span class="s1"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">fig_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">_case</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="si">}</span><span class="s1">_v</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s1">_param</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">param_num</span><span class="si">}</span><span class="s1">.png&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;(weak) &quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">impose_bc</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s1">case</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="si">}</span><span class="s1"> v</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s1"> param</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">param_num</span><span class="si">}</span><span class="s1"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> (M=</span><span class="si">{</span><span class="n">M</span><span class="si">}</span><span class="s1">)&#39;</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;_weak&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">impose_bc</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                <span class="n">fig_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_dir</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">_case</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">testcase</span><span class="si">}</span><span class="s1">_v</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s1">_param</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">param_num</span><span class="si">}</span><span class="s1">_M</span><span class="si">{</span><span class="n">M</span><span class="si">}{</span><span class="nb">type</span><span class="si">}</span><span class="s1">.png&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig_filename</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

        
    
<div class="viewcode-block" id="ErrorEstimations.run_fem_deg">
<a class="viewcode-back" href="../../../enrichedfem.error_estimations.html#enrichedfem.error_estimations.error_estimations.ErrorEstimations.run_fem_deg">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_fem_deg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">new_run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run FEM error estimates for a given degree.</span>

<span class="sd">        This method runs the error estimates using the FEM method for a given</span>
<span class="sd">        degree. It calls the `run_error_estimations_deg` method with the</span>
<span class="sd">        specified parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            degree (int): The degree of the finite element solution.</span>
<span class="sd">            new_run (bool, optional): Whether to force a new run even if a CSV file exists. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the DataFrame, list of h values, and list</span>
<span class="sd">                of error values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_error_estimations_deg</span><span class="p">(</span><span class="s2">&quot;FEM&quot;</span><span class="p">,</span><span class="n">degree</span><span class="p">,</span><span class="n">new_run</span><span class="o">=</span><span class="n">new_run</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="ErrorEstimations.run_corr_deg">
<a class="viewcode-back" href="../../../enrichedfem.error_estimations.html#enrichedfem.error_estimations.error_estimations.ErrorEstimations.run_corr_deg">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_corr_deg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">u_theta</span><span class="p">,</span> <span class="n">new_run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run additive correction error estimates for a given degree.</span>

<span class="sd">        This method runs the error estimates using the additive correction</span>
<span class="sd">        method (&quot;Corr&quot;) for a given degree. It calls the</span>
<span class="sd">        `run_error_estimations_deg` method with the specified parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            degree (int): The degree of the finite element solution.</span>
<span class="sd">            u_theta: The predicted solution.</span>
<span class="sd">            new_run (bool, optional): Whether to force a new run even if a CSV file exists. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the DataFrame, list of h values, and list</span>
<span class="sd">                of error values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_error_estimations_deg</span><span class="p">(</span><span class="s2">&quot;Corr&quot;</span><span class="p">,</span><span class="n">degree</span><span class="p">,</span><span class="n">u_theta</span><span class="o">=</span><span class="n">u_theta</span><span class="p">,</span><span class="n">new_run</span><span class="o">=</span><span class="n">new_run</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="ErrorEstimations.run_mult_deg_M">
<a class="viewcode-back" href="../../../enrichedfem.error_estimations.html#enrichedfem.error_estimations.error_estimations.ErrorEstimations.run_mult_deg_M">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_mult_deg_M</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">u_theta</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">impose_bc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">new_run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run multiplicative correction error estimates for a given degree and M value.</span>

<span class="sd">        This method runs the error estimates using the multiplicative correction</span>
<span class="sd">        method (&quot;Mult&quot;) for a given degree and M value. It calls the</span>
<span class="sd">        `run_error_estimations_deg` method with the specified parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            degree (int): The degree of the finite element solution.</span>
<span class="sd">            u_theta: The predicted solution.</span>
<span class="sd">            M (float, optional): Lifting constant. Defaults to 0.0.</span>
<span class="sd">            impose_bc (bool, optional): Whether to impose boundary conditions. Defaults to True.</span>
<span class="sd">            new_run (bool, optional): Whether to force a new run even if a CSV file exists. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing the DataFrame, list of h values, and list</span>
<span class="sd">                of error values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_error_estimations_deg</span><span class="p">(</span><span class="s2">&quot;Mult&quot;</span><span class="p">,</span><span class="n">degree</span><span class="p">,</span><span class="n">u_theta</span><span class="o">=</span><span class="n">u_theta</span><span class="p">,</span><span class="n">M</span><span class="o">=</span><span class="n">M</span><span class="p">,</span><span class="n">impose_bc</span><span class="o">=</span><span class="n">impose_bc</span><span class="p">,</span><span class="n">new_run</span><span class="o">=</span><span class="n">new_run</span><span class="p">)</span></div>

    
    
<div class="viewcode-block" id="ErrorEstimations.run_fem_alldeg">
<a class="viewcode-back" href="../../../enrichedfem.error_estimations.html#enrichedfem.error_estimations.error_estimations.ErrorEstimations.run_fem_alldeg">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_fem_alldeg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_cvg</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run FEM error estimates for all degrees.</span>

<span class="sd">        This method runs the error estimates using the FEM method for all</span>
<span class="sd">        degrees specified in `self.tab_degree`. It calls the</span>
<span class="sd">        `run_error_estimations_alldeg` method with the specified parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_run (bool, optional): Whether to force a new run even if a CSV file exists. Defaults to False.</span>
<span class="sd">            plot_cvg (bool, optional): Whether to plot the convergence results. Defaults to False.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_error_estimations_alldeg</span><span class="p">(</span><span class="s2">&quot;FEM&quot;</span><span class="p">,</span><span class="n">new_run</span><span class="o">=</span><span class="n">new_run</span><span class="p">,</span><span class="n">plot_cvg</span><span class="o">=</span><span class="n">plot_cvg</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="ErrorEstimations.run_corr_alldeg">
<a class="viewcode-back" href="../../../enrichedfem.error_estimations.html#enrichedfem.error_estimations.error_estimations.ErrorEstimations.run_corr_alldeg">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_corr_alldeg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u_theta</span><span class="p">,</span> <span class="n">new_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_cvg</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run additive correction error estimates for all degrees.</span>

<span class="sd">        This method runs the error estimates using the additive correction</span>
<span class="sd">        method (&quot;Corr&quot;) for all degrees specified in `self.tab_degree`.</span>
<span class="sd">        It calls the `run_error_estimations_alldeg` method with the</span>
<span class="sd">        specified parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            u_theta: The predicted solution.</span>
<span class="sd">            new_run (bool, optional): Whether to force a new run even if a CSV file exists. Defaults to False.</span>
<span class="sd">            plot_cvg (bool, optional): Whether to plot the convergence results. Defaults to False.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_error_estimations_alldeg</span><span class="p">(</span><span class="s2">&quot;Corr&quot;</span><span class="p">,</span><span class="n">u_theta</span><span class="o">=</span><span class="n">u_theta</span><span class="p">,</span><span class="n">new_run</span><span class="o">=</span><span class="n">new_run</span><span class="p">,</span><span class="n">plot_cvg</span><span class="o">=</span><span class="n">plot_cvg</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="ErrorEstimations.run_mult_alldeg_M">
<a class="viewcode-back" href="../../../enrichedfem.error_estimations.html#enrichedfem.error_estimations.error_estimations.ErrorEstimations.run_mult_alldeg_M">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_mult_alldeg_M</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u_theta</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">impose_bc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">new_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_cvg</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run multiplicative correction error estimates for all degrees and a given M value.</span>

<span class="sd">        This method runs the error estimates using the multiplicative correction</span>
<span class="sd">        method (&quot;Mult&quot;) for all degrees specified in `self.tab_degree` and a</span>
<span class="sd">        given M value. It calls the `run_error_estimations_alldeg` method</span>
<span class="sd">        with the specified parameters.</span>

<span class="sd">        Args:</span>
<span class="sd">            u_theta: The predicted solution.</span>
<span class="sd">            M (float, optional): Lifting constant. Defaults to 0.0.</span>
<span class="sd">            impose_bc (bool, optional): Whether to impose boundary conditions. Defaults to True.</span>
<span class="sd">            new_run (bool, optional): Whether to force a new run even if a CSV file exists. Defaults to False.</span>
<span class="sd">            plot_cvg (bool, optional): Whether to plot the convergence results. Defaults to False.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_error_estimations_alldeg</span><span class="p">(</span><span class="s2">&quot;Mult&quot;</span><span class="p">,</span><span class="n">u_theta</span><span class="o">=</span><span class="n">u_theta</span><span class="p">,</span><span class="n">M</span><span class="o">=</span><span class="n">M</span><span class="p">,</span><span class="n">impose_bc</span><span class="o">=</span><span class="n">impose_bc</span><span class="p">,</span><span class="n">new_run</span><span class="o">=</span><span class="n">new_run</span><span class="p">,</span><span class="n">plot_cvg</span><span class="o">=</span><span class="n">plot_cvg</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="ErrorEstimations.run_mult_deg_allM">
<a class="viewcode-back" href="../../../enrichedfem.error_estimations.html#enrichedfem.error_estimations.error_estimations.ErrorEstimations.run_mult_deg_allM">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_mult_deg_allM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">u_theta</span><span class="p">,</span> <span class="n">tab_M</span><span class="p">,</span> <span class="n">impose_bc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">new_run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run multiplicative correction error estimates for a given degree and multiple M values.</span>

<span class="sd">        This method runs the error estimates using the multiplicative correction</span>
<span class="sd">        method (&quot;Mult&quot;) for a given degree and a range of M values.</span>

<span class="sd">        Args:</span>
<span class="sd">            degree (int): The degree of the finite element solution.</span>
<span class="sd">            u_theta: The predicted solution.</span>
<span class="sd">            tab_M (list): A list of M values to use in the multiplicative error estimation.</span>
<span class="sd">            impose_bc (bool, optional): Whether to impose boundary conditions. Defaults to True.</span>
<span class="sd">            new_run (bool, optional): Whether to force a new run even if a CSV file exists. Defaults to False.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="n">tab_M</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_mult_deg_M</span><span class="p">(</span><span class="n">degree</span><span class="p">,</span><span class="n">u_theta</span><span class="p">,</span><span class="n">M</span><span class="o">=</span><span class="n">M</span><span class="p">,</span><span class="n">impose_bc</span><span class="o">=</span><span class="n">impose_bc</span><span class="p">,</span><span class="n">new_run</span><span class="o">=</span><span class="n">new_run</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="ErrorEstimations.run_mult_alldeg_allM">
<a class="viewcode-back" href="../../../enrichedfem.error_estimations.html#enrichedfem.error_estimations.error_estimations.ErrorEstimations.run_mult_alldeg_allM">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run_mult_alldeg_allM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u_theta</span><span class="p">,</span> <span class="n">tab_M</span><span class="p">,</span> <span class="n">impose_bc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">new_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_cvg</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run multiplicative correction error estimates for all degrees and multiple M values.</span>

<span class="sd">        This method runs the error estimates using the multiplicative correction</span>
<span class="sd">        method (&quot;Mult&quot;) for all degrees specified in `self.tab_degree` and a</span>
<span class="sd">        range of M values.</span>

<span class="sd">        Args:</span>
<span class="sd">            u_theta: The predicted solution.</span>
<span class="sd">            tab_M (list): A list of M values to use in the multiplicative error estimation.</span>
<span class="sd">            impose_bc (bool, optional): Whether to impose boundary conditions. Defaults to True.</span>
<span class="sd">            new_run (bool, optional): Whether to force a new run even if a CSV file exists. Defaults to False.</span>
<span class="sd">            plot_cvg (bool, optional): Whether to plot the convergence results. Defaults to False.</span>

<span class="sd">        Returns: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="n">tab_M</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_mult_alldeg_M</span><span class="p">(</span><span class="n">u_theta</span><span class="p">,</span><span class="n">M</span><span class="o">=</span><span class="n">M</span><span class="p">,</span><span class="n">impose_bc</span><span class="o">=</span><span class="n">impose_bc</span><span class="p">,</span><span class="n">new_run</span><span class="o">=</span><span class="n">new_run</span><span class="p">,</span><span class="n">plot_cvg</span><span class="o">=</span><span class="n">plot_cvg</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, F. Lecourtier.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>