name: Build Sphinx Docs in DevContainer

on:
    push:
        branches:
            - main
    pull_request:

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
            uses: actions/checkout@v4

            - name: Set up Docker Buildx
            uses: docker/setup-buildx-action@v2

            - name: Build and run the container from .devcontainer
            run: |
                docker build -f .devcontainer/Dockerfile -t sphinx-docs .
                docker run --rm -v "$(pwd)/docs/_build:/docs/_build" sphinx-docs make html

            - name: Deploy to GitHub Pages
            if: github.ref == 'refs/heads/main'
            uses: JamesIves/github-pages-deploy-action@v4
            with:
                branch: gh-pages
                folder: docs/_build/html
